- import_role:
    name: apt_unit_masked
  vars:
    pkg: logrotate
    unit: logrotate.service
  tags:
    - logrotate

- name: Gather list of config files
  find:
    paths:
      - /etc/logrotate.d
    excludes:
      - "*.dpkg-dist" # diverted files
      - "*~" # ansible backups
  register: logrotate_confs
  become: yes
  tags:
    - logrotate

- name: Configure logrotate compression
  include_tasks:
    file: compression.yml
    apply:
      tags: logrotate
  loop: "{{ logrotate_confs.files | map(attribute='path') + [ '/etc/logrotate.conf' ] }}"
  tags:
    - logrotate

- name: Enable the service
  systemd:
    name: logrotate
    enabled: yes
  become: yes
  tags:
    - logrotate
