- name: Create mount points
  file:
    dest: "{{item.path}}"
    state: directory
    owner: "{{item.owner}}"
    group: "{{item.group}}"
    mode: "{{item.mode}}"
  become: yes
  loop: "{{ mountpoints }}"
  tags:
    - mounts

- name: Mount filesystems
  mount:
    path: "{{ item.path }}"
    src: "{{ item.src }}"
    fstype: "{{ item.fstype }}"
    opts: "{{ item.opts }}"
    state: mounted
    backup: yes
  become: yes
  loop: "{{ mountpoints }}"
  tags:
    - mounts
