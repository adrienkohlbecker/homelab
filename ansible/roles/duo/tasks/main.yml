---

- name: Add duo repository key
  apt_key:
    url:  https://duo.com/APT-GPG-KEY-DUO
    state: present
  become: yes
  tags:
    - duo

- name: Add duo repository
  apt_repository:
    repo: deb http://pkg.duosecurity.com/Ubuntu xenial main
    state: present
    update_cache: yes
  become: yes
  tags:
    - duo

- name: Install duo-unix
  apt:
    pkg: duo-unix
  become: yes
  tags:
    - duo

- name: Configure duo-unix
  template:
    src: pam_duo.conf
    dest: /etc/duo/pam_duo.conf
    owner: root
    group: root
    mode: 0600
  become: yes
  tags:
    - duo

- name: Configure PAM
  template:
    src: pam_sshd.j2
    dest: /etc/pam.d/sshd
    owner: root
    group: root
    mode: 0644
  become: yes
  tags:
    - duo
