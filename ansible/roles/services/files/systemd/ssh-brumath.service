# ssh-brumath #######################################################################
[Unit]
Description=ssh-brumath
After=docker.service zfs-mount.service
Requires=docker.service zfs-mount.service
PartOf=compose.service

StartLimitInterval=300
StartLimitBurst=5

[Service]
Restart=always
TimeoutSec=300
RestartSec=15

SyslogIdentifier=ssh-brumath

ExecStartPre=-/usr/bin/docker kill ssh-brumath
ExecStartPre=-/usr/bin/docker rm ssh-brumath
ExecStartPre=-/usr/bin/docker pull akohlbecker/docker-ssh
ExecStartPre=/bin/sh -c "/usr/bin/stat /mnt/synology/synoquota.db || /usr/bin/bindfs /mnt/brumath/synology /mnt/synology -o map=ak/brumath:@ak/@brumath"
ExecStart=/usr/bin/docker run \
    --init \
    --name ssh-brumath \
    --log-driver none \
    --volume /etc/ssh:/etc/ssh:ro \
    --volume /etc/passwd:/etc/passwd:ro \
    --volume /etc/group:/etc/group:ro \
    --volume /etc/shadow:/etc/shadow:ro \
    --volume /etc/gshadow:/etc/gshadow:ro \
    --volume /home/brumath:/home/brumath:ro \
    --volume /mnt/synology:/data \
    --publish 2223:22 \
    akohlbecker/docker-ssh
ExecStop=/usr/bin/docker stop ssh-brumath

[Install]
WantedBy=compose.service
