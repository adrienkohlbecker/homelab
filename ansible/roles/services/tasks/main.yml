---

- name: Create mount point
  file:
    dest: /mnt/services
    state: directory
    owner: root
    group: root
    mode: 0775
  become: yes
  tags:
    - services

- name: Copy the unit file
  copy:
    src: systemd/compose.service
    dest: /etc/systemd/system/compose.service
    owner: root
    group: root
    mode: 0644
  become: yes
  tags:
    - services
  notify:
    - Restart compose

- name: Enable the service
  systemd:
    name: compose
    enabled: yes
    daemon_reload: yes
  become: yes
  tags:
    - services

- name: Include services
  block:
    - import_tasks: wireguard.yml
    - import_tasks: usenet.yml
    - import_tasks: avahi.yml
    - import_tasks: unifi.yml
    - import_tasks: couchpotato.yml
    - import_tasks: plex.yml
    - import_tasks: portainer.yml
    - import_tasks: sabnzbd.yml
    - import_tasks: samba.yml
    - import_tasks: remote-ssh.yml
    - import_tasks: sickrage.yml
    - import_tasks: speedtest.yml
    - import_tasks: gogs.yml
    - import_tasks: traefik.yml
    - import_tasks: gmvault.yml
    - import_tasks: tautulli.yml
    - import_tasks: homebridge.yml
    - import_tasks: cloudflare-ddns.yml
  when: inventory_hostname == 'homelab'

- name: Include services
  block:
    - import_tasks: wireguard.yml
    - import_tasks: pihole.yml
  when: inventory_hostname == 'pi'
