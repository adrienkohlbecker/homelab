---

- name: Install packages
  apt:
    pkg: "{{item}}"
    state: installed
  become: yes
  with_items:
    - curl
    - git
    - htop
    - jq
    - screen
    - socat
    - tree
    - vim
    - zsh
  tags:
    - user

- name: Add deploy group
  group:
    name: "{{ deploy_user_group }}"
    gid: "{{ deploy_user_gid }}"
  become: yes
  tags:
    - user

- name: Add deploy user
  user:
    name: "{{ deploy_user }}"
    password: "{{ deploy_user_password}}"
    createhome: yes
    shell: /bin/zsh
    uid: "{{ deploy_user_uid }}"
  become: yes
  tags:
    - user

- name: Install oh-my-zsh
  git:
    repo: git://github.com/robbyrussell/oh-my-zsh.git
    dest: "/home/{{ deploy_user }}/.oh-my-zsh"
    accept_hostkey: yes
    version: master
  become: yes
  tags:
    - user

- name: Fix oh-my-zsh perms
  file:
    path: "/home/{{ deploy_user }}/.oh-my-zsh"
    state: directory
    recurse: yes
    owner: "{{ deploy_user }}"
    group: users
  become: yes
  tags:
    - user
