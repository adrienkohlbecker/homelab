---

- name: 'Install build-essential'
  apt: package={{ item }} state=installed
  sudo: true
  with_items:
    - build-essential

- name: Download Snapraid
  get_url: url=http://sourceforge.net/projects/snapraid/files/snapraid-6.2.tar.gz/download dest=/usr/src/snapraid-6.2.tar.gz
  register: downloaded_snapraid
  sudo: true

- name: Extract Snapraid
  shell: tar -xzf snapraid-6.2.tar.gz chdir=/usr/src
  when: downloaded_snapraid|changed
  sudo: true

- name: Compile and install Snapraid
  shell: './configure && make && make install chdir=/usr/src/snapraid-6.2'
  when: downloaded_snapraid|changed
  sudo: true

- name: Copy the configuration
  copy: src=snapraid.conf dest=/etc/snapraid.conf
  sudo: true

- name: Copy the sync script
  copy: src=snapraid_sync.sh dest=/usr/local/bin/snapraid_sync mode=755
  sudo: true

- name: Schedule the sync script
  cron: name="snapraid sync" minute=0 hour=4 job="/usr/local/bin/snapraid_sync >> /var/log/myscript.log 2>&1" user=root cron_file=ansible_snapraid_sync
  sudo: true
