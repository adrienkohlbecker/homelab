- name: source | Add zfs_autobackup group
  group:
    name: zfs_autobackup
    system: true
  become: true
  tags:
    - zfs_autobackup

- name: source | Add zfs_autobackup user
  user:
    name: zfs_autobackup
    group: zfs_autobackup
    system: true
    shell: /bin/bash
  become: true
  register: zfs_autobackup_user
  tags:
    - zfs_autobackup

- name: source | Add authorized keys
  when: not (ansible_check_mode and zfs_autobackup_user.changed)
  ansible.posix.authorized_key:
    user: zfs_autobackup
    key: "{{ ssh_root_at_backup_public_key }}"
    exclusive: true
  become: true
  tags:
    - zfs_autobackup

# TODO: sudo zfs allow zfs_autobackup send,hold,release dataset
